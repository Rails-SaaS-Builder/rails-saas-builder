<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold">New Identity</h1>
  <a href="/admin/identities"
     class="inline-flex items-center gap-1 px-4 py-2 border border-rsb-border rounded-rsb text-sm hover:bg-rsb-bg transition-colors">Back</a>
</div>

<div class="bg-rsb-card border border-rsb-border rounded-rsb-lg shadow-rsb-sm p-6">
  <% if @credential_types.any? %>
    <%# Credential Type Selector %>
    <div class="mb-6">
      <label class="block text-sm font-medium mb-2">Credential Type</label>
      <div class="flex gap-2 flex-wrap">
        <% @credential_types.each do |ctype| %>
          <a href="/admin/identities/new?type=<%= ctype.key %>"
             class="inline-flex items-center gap-1.5 px-3 py-1.5 border rounded-rsb text-sm font-medium transition-colors
                    <%= ctype.key == @selected_type&.key ? 'bg-rsb-primary text-rsb-primary-text border-rsb-primary' : 'border-rsb-border text-rsb-text hover:bg-rsb-bg' %>">
            <%= ctype.label %>
          </a>
        <% end %>
      </div>
    </div>

    <% if @selected_type %>
      <form action="/admin/identities" method="post">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
        <%= hidden_field_tag :credential_type, @selected_type.key %>

        <%# Render the selected type's admin form partial %>
        <%= render partial: @selected_type.admin_form_partial, locals: { credential: @credential } %>

        <div class="mt-6 flex gap-2">
          <button type="submit"
                  class="px-4 py-2 bg-rsb-primary text-rsb-primary-text rounded-rsb text-sm font-medium hover:bg-rsb-primary-hover transition-colors">
            Create Identity
          </button>
          <a href="/admin/identities"
             class="px-4 py-2 border border-rsb-border rounded-rsb text-sm font-medium hover:bg-rsb-bg transition-colors">
            Cancel
          </a>
        </div>
      </form>
    <% end %>
  <% else %>
    <p class="text-rsb-muted text-sm">No credential types with admin form support are available. Register credential types with <code>admin_form_partial</code> to enable identity creation.</p>
  <% end %>
</div>
